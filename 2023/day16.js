function maximizeEnergizedTiles(input) {
  const width = input[0].length;
  const height = input.length;

  const initial = [];
  for (let i = 0; i < width; i++) {
    initial.push(4 * i + 1);
    initial.push(4 * (height * width - i) + 3);
  }
  for (let j = 0; j < width; j++) {
    initial.push(4 * (j * width));
    initial.push(4 * ((j + 1) * width - 1) + 2);
  }

  const count = countEnergizedTiles(input, initial);
  return count.reduce((max, v) => v > max ? v : max, 0);
}

function countEnergizedTiles(input, initial = [0]) {
  const width = input[0].length;
  const height = input.length;

  const goRight = (i, j) => {
    if (i >= width - 1) return -1;
    const index = j * width + i + 1;
    return 4 * index;
  }

  const goDown = (i, j) => {
    if (j >= height - 1) return -1;
    const index = (j + 1) * width + i;
    return 4 * index + 1;
  }

  const goLeft = (i, j) => {
    if (i <= 0) return -1;
    const index = j * width + i - 1;
    return 4 * index + 2;
  }

  const goUp = (i, j) => {
    if (j <= 0) return -1;
    const index = (j - 1) * width + i;
    return 4 * index + 3;
  }

  const nextState = new Int32Array(width * height * 4);
  const altNextState = new Int32Array(width * height * 4);

  for (let j = 0; j < height; j++) {
    for (let i = 0; i < width; i++) {
      const index = j * width + i;
      const char = input[j][i]
      if (char === '.') {
        nextState[4 * index] = goRight(i, j);
        nextState[4 * index + 1] = goDown(i, j);
        nextState[4 * index + 2] = goLeft(i, j);
        nextState[4 * index + 3] = goUp(i, j);
        altNextState[4 * index] = -1;
        altNextState[4 * index + 1] = -1;
        altNextState[4 * index + 2] = -1;
        altNextState[4 * index + 3] = -1;
      } else if (char === '/') {
        nextState[4 * index] = goUp(i, j);
        nextState[4 * index + 1] = goLeft(i, j);
        nextState[4 * index + 2] = goDown(i, j);
        nextState[4 * index + 3] = goRight(i, j);
        altNextState[4 * index] = -1;
        altNextState[4 * index + 1] = -1;
        altNextState[4 * index + 2] = -1;
        altNextState[4 * index + 3] = -1;
      } else if (char === '\\') {
        nextState[4 * index] = goDown(i, j);
        nextState[4 * index + 1] = goRight(i, j);
        nextState[4 * index + 2] = goUp(i, j);
        nextState[4 * index + 3] = goLeft(i, j);
        altNextState[4 * index] = -1;
        altNextState[4 * index + 1] = -1;
        altNextState[4 * index + 2] = -1;
        altNextState[4 * index + 3] = -1;
      } else if (char === '-') {
        nextState[4 * index] = goRight(i, j);
        nextState[4 * index + 1] = goLeft(i, j);
        nextState[4 * index + 2] = goLeft(i, j);
        nextState[4 * index + 3] = goRight(i, j);
        altNextState[4 * index] = -1;
        altNextState[4 * index + 1] = goRight(i, j);
        altNextState[4 * index + 2] = -1;
        altNextState[4 * index + 3] = goLeft(i, j);
      }  else if (char === '|') {
        nextState[4 * index] = goDown(i, j);
        nextState[4 * index + 1] = goDown(i, j);
        nextState[4 * index + 2] = goUp(i, j);
        nextState[4 * index + 3] = goUp(i, j);
        altNextState[4 * index] = goUp(i, j);
        altNextState[4 * index + 1] = -1;
        altNextState[4 * index + 2] = goDown(i, j);
        altNextState[4 * index + 3] = -1;
      } 
    }
  }

  return initial.map(state => {
    const visited = new Set();

    let curr = [state];
  
    while (curr.length > 0) {
      const next = [];
      curr.forEach(currIndex => {
        if (visited.has(currIndex)) return;
        visited.add(currIndex);
        const nextIndex = nextState[currIndex];
        const altNextIndex = altNextState[currIndex];
        if (nextIndex >= 0) next.push(nextIndex);
        if (altNextIndex >= 0) next.push(altNextIndex);
      });
      curr = next;
    }
  
    const energized = new Set();
    for (const v of visited) energized.add(Math.trunc(v / 4));
    return energized.size;
  });
}

const test = String.raw`
\.........../.............../.......\...........................\./.........................|....../.|.......-
....-.........../|......|.......-.......................................................................\./...
-....-...-...........-................|..-..-.-......./.................\.-.......\/-..-..............\.......
...\....-.|.....\.|......./.../...\......|....................................................................
...|..........|.........|........|......|..........................-.../.../...............|.......-.....|....
\......................../.\..............\..|................/..|........./..-................./..\..........
..|..|.....\.....................|.................-...-............................../......\.....\..........
|-.............................../../|...............\.....|..\......................\...........-...-........
|..............\..../........../.....|./.....\........./...........|.....-.../........|....\......|..........|
.|................\....../.....|...........\........\|....-...............-......|........|...................
......\..........................................\...../.....|.../..................-....../..................
.\....\..................\..\......-.............|.........|...................................../-|.....-....
\................/.........-....-......../....|..|/...................\|.\...............-....-............../
.....................\...........-....\......\............||.....-.......\.\.......................\...|.../..
..................|......./....\...-..................|...|/..........................................\.......
..\...................../...................--.................-......../............./..|.......\|.\.|..\|...
...-../....|........../.....\..........-........................../.............................-.......\.-...
../.......|........................-....../........................................./.|...|...........|...\...
.....-./..........................................|........\....\................/.......-...|....-...........
................|..../..|...................-...............\/..|.........................................\...
...........-...\.|..-.\.-.......-./.....\../..-\..-...|........./.............-..........................-...\
.........\../........-.|........|............../....\........|..........|......|../........../...........\....
..|...........................|.............\........\................../.................../......\....\|....
....................-........................//\............../...........-........-........\................/
......./..............|/..|.../............/.-...........-.............................\............../.......
.../............/...|....|\.....-.-..|.......\...|..........-.........\\..........-.-.../......./...../\......
......|/\./.....\..................................|...|.............................................|...-....
............./.|........................................|...\.......-......................../.........\...-..
....................../...\.........\.....................................-.........................\.........
.............\.../....|..................-.|-.-/....|.....-./.......\.......|../..............................
...||...\......./.........\|.\..\....|....../.......\.........-.\.............../.......................\....|
.|......-...............-..||......|../..............................\.../...........-.................|......
.........\/............-....................................|..................................../....\.......
..\........\.-/......|/..//........./.......|./............-./.......................\.-.........../..........
...|..../....|............./|......-..........|..-......................../...\.........../........-...|......
......................../\.....|.................|..........\............-|.........................-.\.......
.........................|..\.\........../..........................................\........................|
-..-......./.................\....|...........-...-.......|...|.....|..|...|........|.\.......................
.......-................./.....................\..|....\......-...|.\.....|.\../..................|......|....
..../....................-....\......-.../.........../........|...././.............-....\............./.......
..|...|..................\.-..............|............\../.................-...............|..|....|.........
..........-....\|.........|.......................|................................\.....--..-.............\..
..........................\...../....-/........................|......................../.\...................
...\................\...........................................\........./............/.......\-......\......
-......./.......................\\................................./|..................\....|...|..-..........
....../..........................\.....\...........\..................\..../...\......\........|...../..../...
..-.........-../....-......-.........../..........-......................\........./......................./..
.......|-..\.......|.....-.........-............-/........../.....\\.............................\./..........
/.-.........../.................................-............./.\....................\....|....\..............
............\......................./../............/.........|../.-.\...................|../.................
../....|................|..\..............\..............................-............./../..|................
...\...............-..........-.....-\...............\..\.//-......./.../|.......|..|.-.........\....\.....-..
.........-........\...........-..................................-...................../.....................|
.\.........-.........|./-.-\.-...........|.../...........|....-..........|-..-...............................\
...........\.../......./..........|.....|.../...............-..................|/....|..........//......--....
.....-.........................................................|..../..|.-......../-......./....|..|..........
.........-..................-..................../..\....................-|......\......................\.....
..........................-.\...|......-...|..-......-./.......-............/....\..............\.......\.....
..-.-.............\............/........../.....................-/.................-./.|/.....................
............\...|...../.|....|...|......|..........|................................\...................\.....
.../....\....../.../...-............./../............./..................//....||...../.........-......-......
..../|..............\-../...-\.\.........../............................../...........-................-...|./
..../|........\......-.................................../........../................-.\|../.........../......
......../.\\...............|..\..........|......|...............-.-.......................|.........\.........
.......|..\..|/........................................................\.......\....|...\...\...........|.....
........./.....\|....................................\..........\\/.......\../\..\\//......-..................
.........|........................................|.....|...........|.../............|....-..-.\\.|...........
.|.................|.........\...............................\..../....\.....\..../..|.......\.......|........
.....|.....-............/........................|.................................................-..........
\.....|.................................\.|.......\................................./.........|.\.............
............................................................/.........\.......................................
..................../.\...//|................./...|./...\|....\\..|.........-.....-.-.........../.../...\.....
.............-........................\...............................-\./...........\........../....\........
.....................|.....|.......................|.....|........../........-...../............|.......\.....
/.-..........................\......../.......\../.....-.......-........................|-...../..............
./...\..\...................|....../..........-................./............./.\..\.......|.\................
....-....\........|...../..-................\|........|........................./\............\......--.\.....
....\../................/.......\.......-.............|.........-.......-..\..................-...............
-......|...................|............................................................................../...
.............../...........\........................|.........../...\..-...........|...........|.....|........
......-....................-........--...|...............//.../.\.|..//...../..............-..\./..\..........
.......\.\................................\......\..|..............\.\.......\.../............../......\...-..
.....|......./../-...../../.../....................\..............|..............\......\....\.\.|............
........|-..........\........................|.......|..-.................|....\...........................\\.
./...............\..............|/................................|.........\......................\..........
.\...........|-..-................-.........../...................................../.....\...................
.-.......|../.........|........|...............................|....../......\....|.........\/....../.........
\.............|................|..../............-.....................\..\.....-|.....-.....|................
............../...\....\/......-.....................................-....-...................|...../.........
........./.............\.............................|.........-..........-.........-.........\.........-.....
.............../.....-...\..\.........\....-......./....\...............\......\-..../........................
.|.......-.|......................|......-....|\|......|...|..............\..........-...\.........|..........
.................../........./..........\../..................../...............|..\.......--.......\.........
..............-..../...................-..../../............-/..|.........................-......|............
.|....|........................|..\............|....-..../|............-.|.|..................|...............
.......//.....\..............|../..............................-...........\|..-..................\....|..|../
........-................|............../....|....-..............-...............|.......\..............|./\..
.............................|.|....../.........../.....\....|.............../...................\.....|......
...../...............|........../../..\..................\/..........................-......-........\..|.....
....../....................../..............\...\.......-.....|/.........-....................................
...........-.\./.../..\.........................\..................................../..|.............-.......
.......|............|............/......................|.\............/....\.\..........-.....-.......-.-....
..............\.....-.\..\....-.../............................-.........|.|...........................|..\...
.../...\..................|........../../..../............./..\..................................|............
..--....|.................................................-..........|../....|.../....../................./...
........./.....................\...................../.|\....||..-../.....-.|.........................-.......
............./......./.....\.........\....-.............-..........\....................-...\.....|...../...-.
..../.-..........\.......\..|.............|........|..-............................./.|............./...-....-
....../....../.....................\......-.........\..........-....\......-............\.|...................
.............................\................\.......-.......................|......|........................
`.trim().split('\n');

console.log(countEnergizedTiles(test)[0]);
console.log(maximizeEnergizedTiles(test));


