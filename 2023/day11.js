function sumShortestDistance(input, factor = 2) {
  const width = input[0].length;
  const height = input.length;

  const xs = new Uint8Array(width);
  const ys = new Uint8Array(height);
  for (let y = 0; y < height; y++) {
    for (let x = 0; x < width; x++) {
      if (input[y][x] === '#') {
        xs[x]++;
        ys[y]++;
      }
    }
  }

  return sumAlongAxis(xs, factor) + sumAlongAxis(ys, factor);
}

function sumAlongAxis(xs, factor) {
  const total = xs.reduce((sum, n) => sum + n, 0);
  let sum = 0;
  let remaining = total;
  let last = -1;
  xs.forEach((n, i) => {
    if (n === 0) return;
    if (last >= 0) {
      let d = i - last;
      d = factor * (d - 1) + 1;
      sum += d * (total - remaining) * remaining;
    }
    last = i;
    remaining -= n;
  });
  return sum;
}

const test = `
.........#................................#................#.................#..........................#...........................#.......
.#............#...................................................................................#.........................................
...................................................................................................................#...........#............
.........................#......................................#........#..................................................................
...................#.....................................................................................................#..................
.......................................#..................................................#.......................................#.........
.............#..................#.....................................#............................#.....#.......#........................#.
...........................................#................................................................................................
#...................................#............................................#....................................#.....................
............................................................................................#...............................................
.............................................................................#.........#....................................................
....#....................#...............#.........#...............#....................................................................#...
..................#.........................................................................................................................
.........................................................#................................#......................#.............#............
...................................................................................#...................#....................................
.....................#...............#........#............................#................................................................
..#.....#......#................#......................................................#....................................................
.........................#......................................#............................................#..........#..............#....
..........................................................#.................................................................................
............................................................................................................................................
...................................#.................................#........#............#.......................#........................
.............#.............................#.........................................................#......................................
..................................................#............................................................................#.....#......
.........................#.....................................................................................#............................
.......#......................................#....................................#.........#..........#...................................
....................#.....................................#..............#..................................................................
.............................#......#.......................................................................................................
............................................................................................................................#.....#.........
...........#................................#...............................................................................................
....#............................#................................................................#..........#..............................
..................................................................................................................#.......................#.
................#........#..............#...................#..........................................#....................................
...................................................#........................#...................................................#...........
.........#....................................#..............................................#........................................#.....
..#...........................................................................................................#.............................
...................................................................................................#....................#...................
...........................................#.....................#.......................#.........................................#........
...................#.........#..............................#............#.....#............................................................
..............#..................................#...................................................................#......................
........................#...................................................................................................................
.......................................#...................................................#.....#.....#.................#..................
................................#............#......#...........................................................#...............#...........
........#.........#..................................................#..................................................................#...
..........................#.................................................................................#...............................
..........................................#.....................#........#........#.........................................#...............
.........................................................#....................................#.............................................
....................................#..........#............................................................................................
..#......#..................#...............................................#...........#................#........#.........................
......................................................................#.....................................................................
............................................................................................................................................
..........................................................#.................................#...........................#.............#.....
............................................................................................................................................
......................#.............................................................#............#..........#...............................
#..........#................................................................................................................................
.................#.................#................................#.........................................................#.............
............................................................................................................................................
..........................#.............#...................................#................#.......................#......................
............................................................................................................................................
........................................................#..................................................................................#
..........#.....................#............#...............#...................#..........................................................
#...................#..................................................................................#....................................
............................................................................................................................................
.........................................#.........................#......#......................#....................#.....................
..........................#.................................................................#...................#.................#.........
..................................................#.........................................................................#...............
............................................................................................................................................
.....#......................................................................#........................#..................#...................
................................................................#.....#...................................#.................................
..........#.......................#.....................#......................................................................#......#.....
................#................................#..............................................#...........................................
#.....................#......#.................................................#............................................................
............................................................................................................................................
..............................................................#.......................................................#.................#...
......#.............................#......#.......#...............#.......................#.............#.................#.....#..........
....................#....................................#..................................................................................
...............................#................................................................................#...........................
..........................#.......................................................................#.........................................
.#............................................#..........................#..................................................................
........#.....#...............................................#..........................#............#......#........................#.....
............................................................................................................................................
........................................................#.................................................................#.................
............................................................................................................................................
............#................#.........#.................................................................#.......#................#........#
.................................................#..........................#..............#...........................#....................
...#.............#.......#.................#................................................................................................
............................................................................................................................................
.....................................#....................#.............#.......................#...........................................
.....................#.............................#....................................................#...................................
............#..................................................................................................#............................
.............................................................................#.....#........................................#...............
..................#...........................................#............................................................................#
...............................#........#.............................#.....................................................................
.........#...............#................................#.................................................................................
...#...............................#...................................................................#....................................
...........................................................................#...........#....................................................
................................................................................#...........................................................
.............................#.................#...................#............................................................#..........#
............#...............................................................................#...............................................
.....................#..................#.....................#....................#...............................#......#.................
................#.......................................................................#.........#.........................................
..........................................................................#................................#................................
................................................#................#...............................................................#..........
.........................#......#..............................................#.................................#..........................
..................#..................#...............................#.....................#.........................................#......
............#......................................................................#..................#.....................................
.....#......................................................................................................#...............................
......................#.....#...............#......#..........................................#...........................#...............#.
............................................................#..........................#....................................................
......................................#.........................................................................#...........................
......................................................................#................................................#......#.............
....................#..........................................#...................#.......#................................................
#.........................................#.................................#............................................................#..
...................................................#...................................................#...................#................
............................................................#......#.................................................#......................
.....#.........................#.............................................................#..................#...........................
.........................................................................#........................................................#.........
............................................................................................................................................
.....................................#......................................................................................................
........................#..................................#...............................#................#.......#......#................
.............................#....................#....................................................#...................................#
..................#..........................#.....................................................................................#........
...............................................................#...........#..................#.............................................
.................................#.................................................................#........................................
.......................................................................................#....................................................
..#................................................#........#...............................................................................
...........#...............................#......................................#.............................#.......#...........#.......
........................#...................................................................................................................
......#................................#....................................#..................#.....#......................................
..................#.....................................#..........#........................................................#...............
.............................#.............................................................................................................#
............#.....................................................................................................................#.........
..............................................#.........................#.................#.................................................
.....#.......................................................#..............................................................................
.....................................#...................................................................#..............#...................
...................................................................................................................#........................
...................#......#.....#........#.........................#...............#........................................................
.....................................................................................................................................#......
...........#.......................................#............................................................#..........#................
......................#.................................#..............#.....#...................#.......................................#..
............................#........#...........................#..........................#...............................................
`
  .trim()
  .split('\n');

console.log(sumShortestDistance(test));
console.log(sumShortestDistance(test, 1e6));
